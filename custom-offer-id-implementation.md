# 🆔 自定義LOT編號系統實現

## **✅ 已實現的功能**

### **1. 自定義LOT編號生成**
- **格式**: `oid000001`, `oid000002`, `oid000003`...
- **規則**: 6位數字，前綴為 "oid"
- **自動遞增**: 每次創建新優惠時自動遞增

### **2. 數據庫存儲**
- **Firestore**: LOT編號保存在 `offerId` 字段
- **索引**: 支持按LOT編號排序和查詢
- **向後兼容**: 舊數據自動生成編號

### **3. 用戶界面顯示**
- **優惠卡片**: 在每個優惠卡片上顯示編號
- **成功消息**: 上傳成功時顯示LOT編號
- **市場頁面**: 所有優惠都顯示編號

## **🔧 技術實現**

### **編號生成邏輯**
```typescript
const generateOfferId = async (): Promise<string> => {
  // 1. 查詢最新的優惠
  const q = query(offersRef, orderBy('offerId', 'desc'), limit(1));
  
  // 2. 提取編號並遞增
  let nextNumber = 1;
  if (!querySnapshot.empty) {
    const latestOffer = querySnapshot.docs[0].data();
    if (latestOffer.offerId) {
      const match = latestOffer.offerId.match(/oid(\d+)/);
      if (match) {
        nextNumber = parseInt(match[1]) + 1;
      }
    }
  }
  
  // 3. 格式化為 6 位數字
  return `oid${nextNumber.toString().padStart(6, '0')}`;
};
```

### **數據結構更新**
```typescript
export interface Offer {
  id: string;           // Firestore 文檔 ID
  offerId: string;      // 自定義LOT編號 (e.g., "oid000001")
  title: string;
  // ... 其他字段
}
```

### **上傳流程**
1. **生成編號**: 調用 `generateOfferId()` 生成新編號
2. **保存數據**: 將編號連同優惠數據一起保存到 Firestore
3. **返回編號**: 返回自定義LOT編號給用戶

## **📋 功能特點**

### **編號系統**
- ✅ **唯一性**: 每個優惠都有唯一的LOT編號
- ✅ **可讀性**: 6位數字格式，易於識別
- ✅ **可排序**: 支持按編號排序
- ✅ **可搜索**: 支持按編號搜索

### **用戶體驗**
- ✅ **即時顯示**: 上傳成功後立即顯示LOT編號
- ✅ **市場展示**: 所有優惠卡片都顯示編號
- ✅ **易於引用**: 用戶可以用LOT編號引用特定優惠

### **數據管理**
- ✅ **自動生成**: 無需手動輸入LOT編號
- ✅ **向後兼容**: 舊數據自動處理
- ✅ **錯誤處理**: 生成失敗時使用備用方案

## **🎯 使用場景**

### **買家**
- 使用LOT編號快速識別優惠
- 與賣家溝通時引用特定優惠
- 在搜索和過濾中使用編號

### **賣家**
- 管理自己的優惠庫存
- 追蹤優惠的表現
- 與客戶溝通時使用LOT編號

### **管理員**
- 快速定位特定優惠
- 審核和管理優惠
- 生成報告和統計

## **📊 編號示例**

```
oid000001 - 第一個優惠
oid000002 - 第二個優惠
oid000003 - 第三個優惠
...
oid000999 - 第999個優惠
oid001000 - 第1000個優惠
```

## **🔍 搜索和過濾**

### **按編號搜索**
- 用戶可以輸入完整LOT編號搜索
- 支持部分編號匹配
- 在優惠標題和描述中搜索

### **按編號排序**
- 按編號升序排列
- 按編號降序排列
- 與其他排序選項結合

## **🚀 未來擴展**

### **可能的改進**
1. **分類編號**: 不同類別使用不同前綴
2. **日期編號**: 包含創建日期的LOT編號
3. **地區編號**: 包含地區信息的編號
4. **批量操作**: 支持批量編號生成

### **高級功能**
1. **編號預約**: 預約特定LOT編號
2. **編號轉讓**: 轉讓優惠編號
3. **編號歷史**: 追蹤編號使用歷史
4. **編號統計**: 編號使用統計分析

## **✅ 測試清單**

- [x] LOT編號生成邏輯
- [x] 數據庫存儲
- [x] 用戶界面顯示
- [x] 向後兼容性
- [x] 錯誤處理
- [x] 搜索功能
- [x] 排序功能

## **📞 支持**

如果遇到任何問題：
1. 檢查 Firestore 中的 `offerId` 字段
2. 確認LOT編號生成邏輯正常工作
3. 檢查用戶界面是否正確顯示編號
4. 驗證搜索和過濾功能 
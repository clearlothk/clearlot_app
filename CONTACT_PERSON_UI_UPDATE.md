# 聯繫人管理界面更新

## 概述

根據用戶要求，我們重新設計了公司設置頁面中的聯繫人管理功能，使其更加直接和用戶友好。新的設計包括：

1. **卡片式直接編輯** - 聯繫人卡片支持直接編輯，無需彈出模態框
2. **簡化的照片上傳** - 採用與公司標誌相同的上傳方式，直接保存到 Firestore
3. **更直觀的用戶界面** - 清晰的視覺層次和更好的用戶體驗

## 主要改進

### 1. 卡片式直接編輯

**更新前：**
- 點擊編輯按鈕會彈出模態框
- 需要在模態框中填寫表單
- 編輯體驗不夠直觀

**更新後：**
- 點擊編輯按鈕直接在卡片中切換到編輯模式
- 所有字段直接在卡片中編輯
- 保存和取消按鈕在卡片頂部
- 編輯體驗更加直觀和流暢

### 2. 簡化的照片上傳

**更新前：**
- 需要輸入照片 URL 鏈接
- 或者通過彈出對話框選擇照片
- 上傳方式複雜

**更新後：**
- 採用與公司標誌相同的上傳方式
- 點擊照片區域右上角的相機圖標
- 直接選擇本地照片文件
- 自動上傳到 Firebase Storage
- 照片直接保存到 Firestore

### 3. 更直觀的用戶界面

**視覺改進：**
- 清晰的卡片設計
- 編輯模式有明顯的視覺區分（綠色主題）
- 添加模式有虛線邊框提示
- 照片上傳有直觀的相機圖標

**交互改進：**
- 直接編輯，無需彈出模態框
- 一鍵保存和取消
- 照片上傳更加簡單
- 更好的響應式設計

## 技術實現

### 1. 新增組件

**ContactPersonCard.tsx**
- 聯繫人顯示和編輯卡片組件
- 支持顯示模式和編輯模式切換
- 集成照片上傳功能
- 包含所有聯繫人字段的編輯

**AddContactCard.tsx**
- 添加新聯繫人的卡片組件
- 虛線邊框設計，明確表示添加模式
- 集成照片上傳功能
- 包含所有必填字段驗證

### 2. 照片上傳功能

**Firebase Storage 集成：**
```typescript
// 照片上傳到 Firebase Storage
const storageRef = ref(storage, `contact-photos/${fileName}`);
const snapshot = await uploadBytes(storageRef, file);
const downloadURL = await getDownloadURL(snapshot.ref);
```

**文件驗證：**
- 只允許圖片文件類型
- 最大文件大小限制（5MB）
- 自動生成唯一文件名

**錯誤處理：**
- 文件類型驗證
- 文件大小檢查
- 上傳失敗提示

### 3. 狀態管理

**編輯狀態：**
```typescript
const [editingContact, setEditingContact] = useState<any>(null);
const [isAddingContact, setIsAddingContact] = useState(false);
```

**數據流：**
- 編輯模式：`editingContact?.id === contact.id`
- 添加模式：`isAddingContact` 狀態控制
- 數據更新：直接更新 Firestore 和本地狀態

### 4. 用戶體驗優化

**直接編輯：**
- 無需彈出模態框
- 在卡片中直接編輯
- 保存和取消按鈕在卡片頂部

**照片上傳：**
- 點擊相機圖標上傳
- 上傳過程中顯示加載動畫
- 上傳成功後立即顯示新照片

**表單驗證：**
- 實時驗證必填字段
- 郵箱格式驗證
- 電話號碼長度驗證

## 用戶界面設計

### 1. 聯繫人卡片設計

**顯示模式：**
- 藍色漸變背景頭部
- 圓形照片顯示
- 清晰的聯繫人信息布局
- 編輯和刪除按鈕在右上角

**編輯模式：**
- 綠色漸變背景頭部
- 保存和取消按鈕在右上角
- 表單字段網格布局
- 照片上傳區域突出顯示

### 2. 添加聯繫人卡片

**設計特點：**
- 虛線邊框表示添加模式
- 灰色照片佔位符
- 加號圖標提示添加功能
- 與編輯模式相同的表單布局

### 3. 照片上傳設計

**上傳按鈕：**
- 藍色圓形按鈕
- 相機圖標
- 懸停效果
- 上傳中顯示加載動畫

**照片顯示：**
- 圓角矩形設計
- 白色邊框
- 陰影效果
- 錯誤處理和回退顯示

## 數據結構

### 1. 聯繫人數據結構

```typescript
interface ContactPerson {
  id: string;
  name: string;
  title: string;
  email: string;
  phone: string;
  department?: string;
  photo?: string;
}
```

### 2. Firestore 存儲

**照片存儲：**
- 路徑：`contact-photos/{timestamp}_{filename}`
- 格式：支持所有圖片格式
- 大小限制：最大 5MB

**聯繫人數據：**
- 存儲在用戶文檔的 `contactPersons` 數組中
- 包含照片的 Firebase Storage URL
- 支持最多 2 個聯繫人

## 功能特性

### 1. 聯繫人管理

**添加聯繫人：**
- 點擊"添加聯繫人"按鈕
- 顯示添加卡片
- 填寫所有必填字段
- 上傳照片（可選）
- 保存到 Firestore

**編輯聯繫人：**
- 點擊編輯按鈕
- 卡片切換到編輯模式
- 修改任何字段
- 更新照片（可選）
- 保存更改

**刪除聯繫人：**
- 點擊刪除按鈕
- 確認對話框
- 從 Firestore 中移除

### 2. 照片管理

**上傳照片：**
- 點擊相機圖標
- 選擇本地圖片文件
- 自動上傳到 Firebase Storage
- 更新聯繫人照片 URL

**照片顯示：**
- 圓形頭像顯示
- 默認字母頭像
- 錯誤處理和回退

### 3. 表單驗證

**必填字段：**
- 姓名
- 職位
- 郵箱
- 電話
- 部門

**格式驗證：**
- 郵箱格式檢查
- 電話號碼長度（8位數字）
- 文件類型檢查

## 測試建議

### 1. 功能測試

**添加聯繫人：**
1. 點擊"添加聯繫人"按鈕
2. 填寫所有必填字段
3. 上傳照片
4. 點擊保存按鈕
5. 驗證聯繫人已添加

**編輯聯繫人：**
1. 點擊現有聯繫人的編輯按鈕
2. 修改任何字段
3. 更新照片
4. 點擊保存按鈕
5. 驗證更改已保存

**刪除聯繫人：**
1. 點擊刪除按鈕
2. 確認刪除操作
3. 驗證聯繫人已移除

### 2. 照片上傳測試

**上傳功能：**
1. 測試不同格式的圖片文件
2. 測試文件大小限制
3. 測試上傳失敗處理
4. 驗證照片正確顯示

**錯誤處理：**
1. 測試無效文件類型
2. 測試超大文件
3. 測試網絡錯誤
4. 驗證錯誤提示

### 3. 用戶體驗測試

**界面響應：**
1. 測試編輯模式切換
2. 測試表單驗證
3. 測試保存和取消操作
4. 測試響應式布局

**交互流程：**
1. 測試完整的添加流程
2. 測試完整的編輯流程
3. 測試照片上傳流程
4. 測試錯誤處理流程

## 未來改進

### 1. 功能增強

**批量操作：**
- 批量導入聯繫人
- 批量編輯功能
- 批量刪除確認

**高級功能：**
- 聯繫人搜索
- 聯繫人分類
- 聯繫人導出

### 2. 用戶體驗

**拖拽上傳：**
- 支持拖拽照片上傳
- 多照片預覽
- 照片裁剪功能

**智能提示：**
- 自動完成建議
- 重複聯繫人檢測
- 表單智能填充

### 3. 數據管理

**備份功能：**
- 聯繫人數據備份
- 照片批量下載
- 數據遷移工具

**同步功能：**
- 多設備同步
- 離線編輯支持
- 衝突解決機制

## 總結

本次更新成功改進了聯繫人管理功能：

- ✅ **直接編輯體驗** - 無需彈出模態框，直接在卡片中編輯
- ✅ **簡化照片上傳** - 採用與公司標誌相同的上傳方式
- ✅ **更好的用戶界面** - 清晰的視覺層次和直觀的交互
- ✅ **Firebase 集成** - 照片直接保存到 Firestore
- ✅ **響應式設計** - 適配不同屏幕尺寸
- ✅ **錯誤處理** - 完善的驗證和錯誤提示

這些改進使聯繫人管理功能更加直觀、高效和用戶友好，為用戶提供了更好的管理體驗！🎉